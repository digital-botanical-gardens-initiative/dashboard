<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DBGI - Browse Dataset</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="../css/style.css" />
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="../app.js" defer></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/modules/sunburst.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/modules/export-data.js"></script>
  <script src="https://code.highcharts.com/modules/accessibility.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var dropDown = document.getElementById("search_type");
      dropDown.onchange = function () {
        var selectedValue = this.value;
        if (selectedValue === "by_text") {
          window.location.href = "/explore/text";
        } else if (selectedValue === "by_structure") {
          window.location.href = "/explore/structure";
        } else if (selectedValue === "SPARQL") {
          window.location.href = "/explore/SPARQL"
      }
    }
    document.querySelector('.tablinks').click();
  });
  </script>
  <script type="text/javascript" language="javascript" src="/JSME_2022-09-26/jsme/jsme.nocache.js"></script>
  <script>
    function updateSMILES(smile) {
      if (smile){
        document.getElementById("smiles").value = smile;
        return true;
      } else {
        alert('Please draw a molecule');
        return false;  // This will prevent form submission
      }
    }
  </script>
  <style>
    .navbar {background-color: green;}
    /* Style the tab */
    .tab {
      overflow: hidden;
      border: 1px solid #ccc;
      background-color: #f1f1f1;
      width: 37%;
      margin-left: auto;
      margin-right: auto;
    }

    /* Style the buttons inside the tab */
    .tab button {
      background-color: inherit;
      float: left;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 14px 16px;
      transition: 0.3s;
      font-size: 17px;
    }

    /* Change background color of buttons on hover */
    .tab button:hover {
      background-color: #ddd;
    }

    /* Create an active/current tablink class */
    .tab button.active {
      background-color: #ccc;
    }

    /* Style the tab content */
    .tabcontent {
      display: none;
      padding: 6px 12px;
      border: 1px solid #ccc;
      border-top: none;
    }
    .slider {
      margin-right: 10%;
      margin-left: 10%;
      width: 80%;
      padding-left: 5%;
      border-radius: 20px;
      display: flex;
      align-items: center;
      box-shadow: 0px 15px 40px #7E6D5766;
    }
    .slider p {
      font-size: 20px;
      font-weight: 600;
      padding-left: 30px;
      color: black;
    }
    .slider input[type="range"] {
      -webkit-appearance:none !important;
      width: 90%;
      height: 2px;
      background: black;
      border: none;
      outline: none;
    }
    .slider input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none !important;
      width: 30px;
      height:30px;
      background: black;
      border: 2px solid black;
      border-radius: 50%;
      cursor: pointer;
    }
    .slider input[type="range"]::-webkit-slider-thumb:hover {
      background: black;
    }

    .jsme {
      margin-left: auto;
      margin-right: auto;
    }

    .submit {
      color: white;
      background-color: green;
      width: 60%;
      margin-left: 20%;
      margin-right: 20%;
    }
    .center {
      margin-right: auto;
      margin-left: auto;
    }
    #loader {
    position: fixed;
    left: 0px;
    top: 0px;
    width: 100%;
    height: 100%;
    z-index: 9999;
    background: url('loader.gif') 50% 50% no-repeat rgb(249,249,249);
    opacity: .8;
    }

  </style>
</head>
<body>
    <%- include('./partials/nav.ejs') %>
    
    <div class="content">
      <%- include('./partials/exploreDropdown.ejs') %>

      <hr>

      <form action="/explore/structure" method="POST">
      <div class="jsme" name="jme" code="JME.class" width=420 height=330>
        You have to enable JavaScript in your browser to use JSME !
      </div>
      <br>
      <div class="tab">
        <button class="tablinks" onclick="openTab(event,'exact_match')">Exact match</button>
        <button class="tablinks" onclick="openTab(event,'sub_search')">Substructure search</button>
        <button class="tablinks" onclick="openTab(event,'sim_search')">Similarity search</button>
      </div>
      <input type="hidden" id="activeTab" name="activeTab" value="default_tab">
      
      <div id="exact_match" class="tabcontent">
        <br>
        <h3>Exact match type: using InChI (recommended) or SMILES</h3>
        <label class="container">
          <input type="radio" checked="checked" name="radio" value="structure_inchi">
          Exact match (by InChI)
          <span class="checkmark"></span>
        </label>
        <label class="container">
          <input type="radio" name="radio" value="structure_smiles">
          Exact match (by canonical SMILES)
          <span class="checkmark"></span>
        </label>
      </div>
      
      <div id="sub_search" class="tabcontent">
        <br>
        <h3>Substructure matching algorithm</h3>
        <label class="container">
          <input type="radio" checked="checked" name="radio">
          Default substructure search (Ullmann algorithm)
          <span class="checkmark"></span>
        </label>
        <label class="container">
          <input type="radio" name="radio">
          Substructure search with depth-first (DF) pattern
          <span class="checkmark"></span>
        </label>
        <label class="container">
          <input type="radio" name="radio">
          Substructure search with Vento-Foggia algorithm
          <span class="checkmark"></span>
        </label>
      </div>
      
      <div id="sim_search" class="tabcontent">
        <br>
        <h3>Select Tanimoto similarity threshold (in %)</h3>
        <div class="slider">
          <br>
          <input type="range" min="0" max="100" value="50" oninput="rangeValue.innerText = this.value" name="tanimoto">
          <p id="rangeValue">50</p>
        </div>
      </div>
      
      <hr>
      (Optional) Structure search only in a taxonomic group:
      <input type="text" id="taxo" name="taxo">
      <hr>
      <div>
        Select maximal number of returned hits:
        <select name="maxNum" id="maxNum">
          <option value="10">10</option>
          <option value="100">100</option>
          <option value="250">250</option>
          <option value="1000">1000</option>
          <option value="10000">10000</option>
        </select>
      </div>
      <hr>
      <div id="display_option">
        <h6>Display options</h6>
        <label class="container">
          <input type="radio" id="display" name="display" value="table">
          Table
          <span class="checkmark"></span>
        </label>
        <label class="container">
          <input type="radio" id="display" name="display" value="graph">
          Graphical
          <span class="checkmark"></span>
        </label>
      </div>
      <hr>
      <input id="smiles" type="hidden" name="smiles" value="">
      <button class="submit" type="submit" onclick="return updateSMILES(document.jme.smiles());"><i class="fa fa-search"></i> Search</button>

      </form>
      <br>

      <script>
        function openTab(evt, tab) {
          evt.preventDefault();
          var i, tabcontent, tablinks;
          tabcontent = document.getElementsByClassName("tabcontent");
          for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
          }
          tablinks = document.getElementsByClassName("tablinks");
          for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
          }
          document.getElementById(tab).style.display = "block";
          evt.currentTarget.className += " active";

          document.getElementById('activeTab').value = tab;
        }
      </script>


      <br>
      <div id="loader" style="display: none;">
        Loading...
      </div>
      <script>
        $(document).ready(function() {
            $('form').submit(function() {
                $("#loader").show();
            });
    
            $(document).ajaxComplete(function() {
                $("#loader").hide();
            });
        });
      </script>

      <% if(display === 'table') { %>
        <%- include('./partials/exploreTable.ejs') %>
      <% } else if(display === 'graph') { %>
        <%- include('./partials/exploreGraph.ejs') %>
      <% } %>
    </div>    
</body>
</html>